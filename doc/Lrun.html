<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Lrun
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (L)</a> &raquo;
    
    
    <span class="title">Lrun</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Lrun
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/lrun.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Run program using <tt>lrun</tt>. Require external <tt>lrun</tt> binary.</p>

<h1>Example</h1>

<pre class="code ruby"><code class="ruby"><span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>foo</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:max_memory</span> <span class='op'>=&gt;</span> <span class='int'>2</span> <span class='op'>**</span> <span class='int'>20</span><span class='comma'>,</span> <span class='symbol'>:max_cpu_time</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:network</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#run-class_method" title="Lrun.run (method)">Lrun.run</a></span></li>
    
      <li><a href="https://github.com/quark-zju/lrun" target="_parent" title="lrun project page">lrun project page</a></li>
    
  </ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Lrun/LrunError.html" title="Lrun::LrunError (class)">LrunError</a></span>, <span class='object_link'><a href="Lrun/Result.html" title="Lrun::Result (class)">Result</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="LRUN_BINARY-constant" class="">LRUN_BINARY =
          <div class="docstring">
  <div class="discussion">
    
<p>Name of lrun executable</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>lrun</span><span class='tstring_end'>'</span></span></pre></dd>
      
        <dt id="LRUN_PATH-constant" class="">LRUN_PATH =
          <div class="docstring">
  <div class="discussion">
    
<p>Full path of lrun executable, automatically detected using <span class='object_link'><a href="#LRUN_BINARY-constant" title="Lrun::LRUN_BINARY (constant)">LRUN_BINARY</a></span>
and <tt>PATH</tt> environment variable</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PATH</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='const'>LRUN_BINARY</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span> <span class='id identifier rubyid_p'>p</span><span class='rbrace'>}</span></pre></dd>
      
        <dt id="LRUN_OPTIONS-constant" class="">LRUN_OPTIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>Available lrun options, and whether they can occur multiple times (1: no,
2: yes)</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:max_cpu_time</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_real_time</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_memory</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_output</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_nprocess</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_rtprio</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_nfile</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:max_stack</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:isolate_process</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:basic_devices</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:reset_env</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:network</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:chroot</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:chdir</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:nice</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:umask</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:gid</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:interval</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:cgname</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:bindfs</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:cgroup_option</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:tmpfs</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:env</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:group</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:cmd</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="TRUNCATE_OUTPUT_LENGTH-constant" class="">TRUNCATE_OUTPUT_LENGTH =
          <div class="docstring">
  <div class="discussion">
    
<p>Keep how many bytes of stdout and stderr, can be overrided using
<tt>options[:truncate]</tt></p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4096</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge_options-class_method" title="merge_options (class method)">+ (Hash) <strong>merge_options</strong>(*options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Merge options so that it can be used in <span class='object_link'><a href="#run-class_method" title="Lrun.run (method)">Lrun.run</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-class_method" title="run (class method)">+ (LrunResult) <strong>run</strong>(commands, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run program using <tt>lrun</tt> binary.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="merge_options-class_method">
  
    + (<tt>Hash</tt>) <strong>merge_options</strong>(*options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Merge options so that it can be used in <span class='object_link'><a href="#run-class_method" title="Lrun.run (method)">run</a></span>.</p>

<h1>Example</h1>

<pre class="code ruby"><code class="ruby"><span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='int'>1000</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:gid</span> <span class='op'>=&gt;</span> <span class='int'>100</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {:uid=&gt;1000, :gid=&gt;100}
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:nice</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='int'>1001</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:nice</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {:nice=&gt;2, :uid=&gt;1000}
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>6</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='int'>7</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {:fd=&gt;[4, 6, 5, 7]}
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:env</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>A</span><span class='tstring_end'>'</span></span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>B</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>2</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:env</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>C</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>3</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {:env=&gt;[[&quot;A&quot;, &quot;1&quot;], [&quot;B&quot;, &quot;2&quot;], [&quot;C&quot;, &quot;3&quot;]]}
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='int'>1000</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {}
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:fd</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {}
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:network</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:chdir</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/tmp</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:bindfs</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/a</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/b</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span>
                   <span class='lbrace'>{</span><span class='symbol'>:network</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:bindfs</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/c</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/d</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'># =&gt; {:chdir=&gt;&quot;/tmp&quot;, :bindfs=&gt;[[&quot;/a&quot;, &quot;/b&quot;], [&quot;/c&quot;, &quot;/d&quot;]]}</span></code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>options to be merged</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>merged options</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lrun.rb', line 148</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_merge_options'>merge_options</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='comment'># Remove nil
</span>  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>

  <span class='comment'># Check type of options
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>options should be Hash</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_o'>o</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span> <span class='rbrace'>}</span>

  <span class='comment'># Merge options
</span>  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_option'>option</span><span class='op'>|</span>
    <span class='id identifier rubyid_option'>option</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='comment'># Remove an option using nil
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_k'>k</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='comment'># Append to or Replace an option
</span>      <span class='kw'>case</span> <span class='const'>LRUN_OPTIONS</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='int'>2</span>
        <span class='comment'># Append to previous options
</span>        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='lbracket'>[</span><span class='op'>*</span><span class='id identifier rubyid_v'>v</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='comment'># Overwrite previous option
</span>        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-class_method">
  
    + (<tt>LrunResult</tt>) <strong>run</strong>(commands, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Run program using <tt>lrun</tt> binary.</p>

<h1>Example</h1>

<pre class="code ruby"><code class="ruby"><span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>echo hello</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; #&lt;struct Lrun::Result
</span><span class='comment'>#             memory=262144, cputime=0.002,
</span><span class='comment'>#             exceed=nil, exitcode=0, signal=nil,
</span><span class='comment'>#             stdout=&quot;hello\n&quot;, stderr=&quot;&quot;&gt;
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:max_memory</span> <span class='op'>=&gt;</span> <span class='int'>2</span> <span class='op'>**</span> <span class='int'>19</span><span class='comma'>,</span> <span class='symbol'>:stdout</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/tmp/out.txt</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; #&lt;struct Lrun::Result
</span><span class='comment'>#             memory=524288, cputime=0.006,
</span><span class='comment'>#             exceed=:memory, exitcode=0, signal=nil,
</span><span class='comment'>#             stdout=nil, stderr=&quot;&quot;&gt;
</span>
<span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sleep 30</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:max_real_time</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:stderr</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/dev/null</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='comment'>#  =&gt; #&lt;struct Lrun::Result
</span><span class='comment'>#              memory=262144, cputime=0.002,
</span><span class='comment'>#              exceed=:time, exitcode=0, signal=nil,
</span><span class='comment'>#              stdout=&quot;&quot;, stderr=nil&gt;
</span>
 <span class='const'>Lrun</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cat</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:max_output</span> <span class='op'>=&gt;</span> <span class='int'>100</span><span class='comma'>,</span> <span class='symbol'>:stdin</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/dev/urandom</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:truncate</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
 <span class='comment'># =&gt; #&lt;struct Lrun::Result
</span> <span class='comment'>#             memory=782336, cputime=0.05,
</span> <span class='comment'>#             exceed=:output, exitcode=0, signal=nil,
</span> <span class='comment'>#             stdout=&quot;U\xE1&quot;, stderr=&quot;&quot;&gt;</span></code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>commands</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>, <tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>commands to be executed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>options for lrun. Besides options in <span class='object_link'><a href="#LRUN_OPTIONS-constant" title="Lrun::LRUN_OPTIONS (constant)">LRUN_OPTIONS</a></span>, there are some
additional options available:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p>truncate</p></td>
<td>
<p>maximum bytes read for stderr and stdout (default:
<span class='object_link'><a href="#TRUNCATE_OUTPUT_LENGTH-constant" title="Lrun::TRUNCATE_OUTPUT_LENGTH (constant)">TRUNCATE_OUTPUT_LENGTH</a></span>).</p>
</td></tr><tr><td class="rdoc-term"><p>stdin</p></td>
<td>
<p>stdin file path (default: no input).</p>
</td></tr><tr><td class="rdoc-term"><p>stdout</p></td>
<td>
<p>stdout file path (default: a tempfile, will be deleted automatically). If
this option is set, the returned result will have no stdout, you should
read and delete stdout file manually.</p>
</td></tr><tr><td class="rdoc-term"><p>stderr</p></td>
<td>
<p>stderr file path (default: a tempfile, will be deleted automatically). If
this option is set, the returned result will have no stderr, you should
read and delete stderr file manually.</p>
</td></tr></table>

<p>Note: lrun chroot and mounts does not affect above paths.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>LrunResult</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lrun.rb', line 231</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_commands'>commands</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tmp_out'>tmp_out</span><span class='comma'>,</span> <span class='id identifier rubyid_tmp_err'>tmp_err</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>

  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rfd'>rfd</span><span class='comma'>,</span> <span class='id identifier rubyid_wfd'>wfd</span><span class='op'>|</span>
    <span class='comment'># Expand commands if commands is a string
</span>    <span class='id identifier rubyid_commands'>commands</span> <span class='op'>=</span> <span class='const'>Shellwords</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='id identifier rubyid_commands'>commands</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_commands'>commands</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span>

    <span class='comment'># Create temp stdout, stderr files
</span>    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:stdout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lparen'>(</span><span class='id identifier rubyid_tmp_out'>tmp_out</span> <span class='op'>=</span> <span class='const'>Tempfile</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lrun.</span><span class='embexpr_beg'>#{</span><span class='gvar'>$$</span><span class='rbrace'>}</span><span class='tstring_content'>.out</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:stderr</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lparen'>(</span><span class='id identifier rubyid_tmp_err'>tmp_err</span> <span class='op'>=</span> <span class='const'>Tempfile</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lrun.</span><span class='embexpr_beg'>#{</span><span class='gvar'>$$</span><span class='rbrace'>}</span><span class='tstring_content'>.err</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>

    <span class='comment'># Keep pid of lrun process for checking its status
</span>    <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn_lrun'>spawn_lrun</span> <span class='id identifier rubyid_commands'>commands</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_wfd'>wfd</span>

    <span class='comment'># Read fd 3, where lrun write its report
</span>    <span class='lbracket'>[</span><span class='id identifier rubyid_wfd'>wfd</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:close</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='id identifier rubyid_rfd'>rfd</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>

    <span class='comment'># Check if lrun exits normally
</span>    <span class='id identifier rubyid_stat'>stat</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_wait2'>wait2</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_signaled?'>signaled?</span> <span class='op'>||</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>LrunError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lrun exits abnormally: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stat'>stat</span><span class='rbrace'>}</span><span class='tstring_content'>. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tmp_err'>tmp_err</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='kw'>unless</span> <span class='id identifier rubyid_tmp_err'>tmp_err</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Build and return result
</span>    <span class='id identifier rubyid_build_result'>build_result</span> <span class='id identifier rubyid_report'>report</span><span class='comma'>,</span> <span class='id identifier rubyid_tmp_out'>tmp_out</span><span class='comma'>,</span> <span class='id identifier rubyid_tmp_err'>tmp_err</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:truncate</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_tmp_out'>tmp_out</span><span class='comma'>,</span> <span class='id identifier rubyid_tmp_err'>tmp_err</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sat Mar 23 09:27:50 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.9.3).
</div>

  </body>
</html>